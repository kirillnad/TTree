# Формат Markdown для импорта в Memus (по коду сервера)

Источник правил: `TTree/servpy/app/main.py`:
- парсер: `_parse_markdown_blocks` (используется в `/api/import/markdown` и импорте Logseq ZIP);
- endpoint: `@app.post('/api/import/markdown')`.

## Общие принципы

Это **не полноценный Markdown**. Импорт ориентирован на “деревянный” список, который превращается в дерево блоков Memus.

## 1) Как создаются блоки

Строка создаёт **новый блок**, если выполняется одно из условий:

1. Строка (после табов) начинается с `-`:
   - `- Текст блока`
   - `\t- Дочерний блок`
2. Строка **без табов** (`indent_tabs == 0`) и **не начинается с `-`** — это тоже новый корневой блок.
   Это нужно для импорта заголовков/нумерованных пунктов вида `1. Текст`.

Любая другая непустая строка считается **продолжением предыдущего блока**.

## 2) Вложенность

Уровень вложенности определяется **только количеством табов `\t` перед первым нетабовым символом**.

- Пробелы в начале строки не увеличивают вложенность.
- Рекомендуется использовать табы, как в Logseq/Obsidian-экспортах.

## 3) Пустые строки

Пустая строка не создаёт новый блок: она добавляется в текущий блок как пустой абзац.

## 4) Служебные строки Logseq

Перед разбором дерево блоков выполняется предобработка:

- Любые строки, начинающиеся (после табов/пробелов) с `logseq.` — **игнорируются**.
- Любые строки, содержащие `collapsed::`:
  - если строка вида `- collapsed:: true/false` — парсер пытается “слить” со следующей строкой
    и заменить её на `- <текст_следующей_строки>` (Logseq-совместимость);
  - в остальных случаях строка выкидывается.

## 5) Заголовок блока

Заголовок блока в Memus определяется не маркдауном, а мемусовской логикой:
“первая строка + пустая строка” (дальше — тело блока).

То есть файл может содержать строки вида `# ...`, но сама структура “title/body” определяется
по пустому абзацу между первой строкой и остальным текстом внутри блока.

## 6) Инлайн‑форматирование

Минимально поддерживается:
- `**жирный**` → `<strong>жирный</strong>`.

Также есть преобразование строк в `<p>...</p>` и поддержка простых таблиц (pipe‑таблицы) в HTML.

## 7) Имя создаваемой статьи (важно)

При импорте через “Импорт из Markdown” заголовок статьи = **имя файла без расширения**.

Рекомендация: если вы хотите, чтобы `[[Название]]` работали, называйте файл так же, как будущий заголовок статьи.

## 8) Импорт Logseq ZIP

Для “Импорт из Obsidian/Logseq” ожидается ZIP:
- `pages/` с `*.md` / `*.markdown` / `*.txt` (каждый файл = отдельная статья);
- опционально `assets/` (вложения).

Требования:
- имена файлов/папок в ZIP должны быть в UTF‑8 (иначе импорт отклоняется);
- импорт страниц использует тот же парсер, что и “Импорт из Markdown”.

